import os
import sys
import pulsar as psr

def run(mm):
    tester=psr.PyTester("Testing the Pulsar-ForceManII API")
    wfn=psr.Wavefunction()
    wfn.system=psr.make_system("""
    0 1
    N 0.000000 0.000000 0.000000
    C 0.000000 0.000000 1.471000
    C 1.418997 0.000000 2.021393
    O 1.705174 0.681374 3.003367
    H 0.476034 0.824515 -0.337145
    H -0.952067 -0.001173 -0.337145
    H 0.475018 -0.825101 -0.337145
    H -0.531389 0.879397 1.834849
    C -0.804856 -1.176573 2.023924
    H -0.799485 -1.168722 3.113882
    H -0.377518 -2.123974 1.695422
    H -1.842725 -1.121673 1.695422
    N 2.306979 -0.767293 1.385017
    C 3.689219 -0.853327 1.811179
    C 4.340315 0.521240 1.755303
    O 5.112956 0.879894 2.641212
    H 2.017285 -1.307410 0.582241
    H 3.732392 -1.235189 2.831187
    H 4.229384 -1.538617 1.157957
    N 4.025560 1.289714 0.710027
    C 4.578812 2.618392 0.542315
    C 4.197179 3.497008 1.725055
    O 5.011396 4.283150 2.204088
    H 3.384260 0.944536 0.010250
    H 5.664656 2.554197 0.472155
    C 4.083820 3.220565 -0.773060
    C 4.628362 4.627880 -1.019593
    C 4.296805 2.288112 -1.965960
    H 2.994556 3.216461 -0.812896
    H 4.255869 5.025213 -1.963773
    H 5.717170 4.616480 -1.069274
    H 4.315676 5.306495 -0.225988
    H 3.933253 2.748544 -2.884618
    H 3.755391 1.352611 -1.825216
    H 5.356212 2.069232 -2.099560
    N 2.954801 3.361098 2.194363
    C 2.470528 4.140065 3.316098
    C 3.320883 3.866985 4.548496
    O 3.629953 4.783742 5.306436
    H 2.326281 2.699019 1.762257
    H 2.517156 5.200807 3.069618
    C 1.000760 3.809184 3.577138
    C 0.418322 4.596236 4.751513
    C -1.051445 4.265355 5.012554
    C 1.278147 4.497981 6.012024
    H 0.867856 2.737831 3.727599
    H 0.405452 3.963075 2.677124
    H 0.551226 5.667590 4.601052
    H -1.432827 4.843205 5.854419
    H -1.171909 3.208778 5.251788
    H -1.660858 4.504360 4.141008
    H 0.833939 5.069557 6.826936
    H 2.275829 4.897466 5.829975
    H 1.364261 3.462033 6.339887
    N 3.698099 2.601721 4.746080
    C 4.509056 2.213006 5.882236
    C 5.838510 2.953427 5.853703
    O 6.333006 3.383999 6.893184
    H 3.415442 1.887112 4.090688
    H 3.980018 2.450556 6.805159
    C 4.721869 0.698940 5.869667
    C 5.572222 0.212846 7.043742
    C 5.228705 0.185500 4.521580
    C 5.785035 -1.301219 7.031173
    H 3.766015 0.175717 5.843580
    H 5.139583 0.533256 7.991509
    H 6.528076 0.736070 7.069829
    H 4.600353 0.550723 3.709246
    H 5.210723 -0.903970 4.492768
    H 6.246283 0.529394 4.336185
    H 6.393979 -1.611764 7.880202
    H 6.299474 -1.610446 6.121321
    H 4.831271 -1.824903 7.095912
    N 6.415534 3.100056 4.658810
    C 7.681966 3.785785 4.499039
    C 7.564133 5.222455 4.987486
    O 8.480450 5.740894 5.621540
    H 8.450836 3.268325 5.072775
    C 8.113435 3.736474 3.033009
    C 7.112985 2.992119 2.148207
    C 5.909355 2.466927 2.931337
    H 9.108750 3.302242 2.938711
    H 8.293266 4.741113 2.650307
    H 7.604098 2.182752 1.607992
    H 6.788615 3.621622 1.319589
    H 5.896371 1.377005 2.932688
    H 4.994790 2.967790 2.613835
    N 6.431773 5.863960 4.690069
    C 6.198293 7.234538 5.098241
    C 6.251745 7.344826 6.615299
    O 6.793077 8.309964 7.150003
    H 5.710638 5.389371 4.165828
    H 6.959575 7.879556 4.659492
    C 4.848922 7.710179 4.558978
    O 4.626057 9.043900 4.958503
    H 4.041460 7.079283 4.930562
    H 4.825003 7.647419 3.471049
    H 3.789815 9.323093 4.618244
    N 5.687741 6.352050 7.307050
    C 5.672817 6.340425 8.755927
    C 7.096584 6.350515 9.293767
    O 7.384606 7.027049 10.278544
    H 5.256265 5.582111 6.816007
    H 5.139600 7.218059 9.121356
    C 4.905065 5.115409 9.253653
    O 4.893150 5.108272 10.663585
    C 5.495111 3.801081 8.741571
    H 3.880727 5.125158 8.881179
    H 4.415928 4.346674 10.955564
    H 4.924223 2.951014 9.115166
    H 6.525315 3.684303 9.077938
    H 5.470518 3.766178 7.652408
    N 7.986555 5.597277 8.643529
    C 9.373329 5.521939 9.056790
    C 10.010018 6.903438 9.006060
    O 10.786857 7.262966 9.887934
    H 7.695186 5.060549 7.839087
    H 9.429423 5.132561 10.073322
    C 10.125049 4.536213 8.161747
    S 11.850762 4.465270 8.703024
    H 10.083315 4.852997 7.119631
    H 9.682305 3.542279 8.226350
    H 12.246815 3.573533 7.790422
    N 9.678245 7.676838 7.969719
    C 10.216566 9.012333 7.807661
    C 9.836638 9.877745 9.000641
    O 10.647123 10.668334 9.478684
    H 9.034255 7.330659 7.272914
    H 11.302335 8.959710 7.727421
    C 9.703846 9.619732 6.501512
    C 10.207865 11.017942 6.234912
    C 11.398238 11.209115 5.523248
    C 9.484794 12.123121 6.699398
    C 11.865539 12.505469 5.276070
    C 9.952096 13.419475 6.452219
    C 11.142469 13.610648 5.740555
    H 8.614159 9.614713 6.475903
    H 9.948590 8.977288 5.655660
    H 11.956035 10.356548 5.164931
    H 8.566507 11.975644 7.248396
    H 12.783827 12.652945 4.727072
    H 9.394299 14.272042 6.810537
    H 11.502959 14.610692 5.549875
    N 8.599918 9.725566 9.479795
    C 8.117820 10.490774 10.611891
    C 8.981818 10.216696 11.834541
    O 9.288366 11.130580 12.596962
    H 7.974282 9.060547 9.048020
    H 8.151562 11.553831 10.373416
    C 6.653843 10.142963 10.883254
    C 6.051209 10.889377 12.049358
    C 5.422266 12.122723 11.841307
    C 6.121420 10.348069 13.338566
    C 4.863533 12.814763 12.922463
    C 5.562687 11.040109 14.419722
    C 4.933743 12.273455 14.211671
    O 4.389377 12.947699 15.265026
    H 6.534757 9.070460 11.037060
    H 6.047168 10.308099 9.992875
    H 5.368103 12.540304 10.846775
    H 6.606605 9.396630 13.499063
    H 4.378347 13.766202 12.761966
    H 5.616849 10.622528 15.414254
    H 4.492824 12.493596 16.087288
    N 9.373507 8.953816 12.018765
    C 10.198419 8.564467 13.144612
    C 11.520037 9.318540 13.110219
    O 12.019399 9.745957 14.148676
    H 9.092245 8.241529 11.360253
    H 9.675247 8.789404 14.074017
    C 10.426358 7.052784 13.118178
    C 11.275040 6.542221 14.250026
    N 10.717831 6.139562 15.447750
    C 12.625278 6.630374 14.464472
    C 11.682717 5.983895 16.368842
    N 12.832087 6.277596 15.783539
    H 10.863733 6.745644 12.168194
    H 9.475556 6.519907 13.107250
    H 9.717460 6.184042 15.579583
    H 13.391126 7.164750 13.921961
    H 11.629048 5.168107 17.074541
    H 13.571144 6.716606 16.313788
    N 12.084899 9.480367 11.911483
    C 13.342884 10.180141 11.745985
    C 13.214931 11.611673 12.246812
    O 14.131583 12.134403 12.876847
    H 11.630527 9.108161 11.089833
    H 14.122005 9.666033 12.308802
    C 13.761766 10.146689 10.275863
    C 15.049760 10.834710 9.955356
    C 16.267021 10.246457 9.967085
    C 15.268564 12.226698 9.576973
    N 17.216782 11.187246 9.620630
    C 16.645241 12.418571 9.372478
    C 14.450530 13.351299 9.383821
    C 17.189376 13.652758 8.997377
    C 15.019154 14.574410 9.008764
    C 16.352176 14.759265 8.810990
    H 12.969690 10.542868 9.640443
    H 13.795768 9.121143 9.908168
    H 16.368265 9.209211 9.683763
    H 18.093177 10.893790 9.213303
    H 13.382620 13.272835 9.524573
    H 18.254977 13.751254 8.851798
    H 14.361700 15.419664 8.868411
    H 16.701348 15.611727 8.247265
    N 12.073563 12.243964 11.964482
    C 11.829924 13.608865 12.385538
    C 11.895759 13.707809 13.902891
    O 12.432075 14.674174 14.440426
    H 11.352610 11.766201 11.442880
    H 12.580733 14.264990 11.945213
    C 10.471084 14.074997 11.861979
    C 10.182384 15.507732 12.286722
    O 9.095317 16.001321 11.916377
    O 11.054164 16.082553 12.973803
    H 9.675413 13.421893 12.220397
    H 10.431529 14.002720 10.775097
    N 11.347966 12.703976 14.591706
    C 11.346054 12.680858 16.040521
    C 12.774375 12.701183 16.565847
    O 13.064318 13.372874 17.553372
    H 10.919918 11.933566 14.098406
    H 10.807293 13.550148 16.417576
    C 10.595144 11.444255 16.535283
    C 10.573756 11.388248 18.056101
    O 10.012760 10.461489 18.636481
    N 11.123315 12.420488 18.700067
    H 11.050819 10.534637 16.144060
    H 9.573099 11.436941 16.156508
    H 11.524388 13.184022 18.174466
    H 11.234931 12.384403 19.703232
    N 13.666071 11.962128 15.901842
    C 15.057156 11.897632 16.302248
    C 15.679414 13.285875 16.256846
    O 16.460408 13.646352 17.134654
    H 13.372979 11.428786 15.095776
    H 15.126214 11.500897 17.315131
    C 15.810776 10.926622 15.392833
    C 17.291039 10.805956 15.756294
    C 18.005082 9.832114 14.829872
    O 19.225440 9.649779 15.029821
    O 17.317195 9.288241 13.939078
    H 15.692679 11.208244 14.346486
    H 15.332536 9.947141 15.394558
    H 17.408683 10.478266 16.789193
    H 17.780113 11.778890 15.708276
    N 15.330656 14.063958 15.229627
    C 15.854029 15.406075 15.073409
    C 15.476030 16.258221 16.276508
    O 16.282728 17.053226 16.753631
    H 14.684012 13.716729 14.535809
    H 16.939515 15.365102 14.983183
    C 15.323612 16.018447 13.776682
    C 15.835289 17.440225 13.543070
    C 15.285923 18.013841 12.244745
    O 15.589313 19.150605 11.889548
    N 14.418880 17.251741 11.574175
    H 14.234112 15.992786 13.755915
    H 15.557889 15.379847 12.924976
    H 16.924818 17.458095 13.516481
    H 15.559557 18.090243 14.373461
    H 14.161636 16.345238 11.937737
    H 14.108426 17.534041 10.655467
    N 14.245219 16.089754 16.765330
    C 13.765528 16.841144 17.907657
    C 14.643088 16.566284 19.120432
    O 14.947184 17.477235 19.887332
    H 13.622499 15.421822 16.333836
    H 13.786431 17.906324 17.677319
    C 12.307602 16.476383 18.189158
    C 11.730560 17.233037 19.385961
    S 10.005102 16.841691 19.767724
    C 9.779394 17.933022 21.193961
    H 12.198950 15.400333 18.324849
    H 11.693332 16.632112 17.302298
    H 11.838016 18.309130 19.249666
    H 12.344093 17.076236 20.273143
    H 8.762662 17.830528 21.573237
    H 9.916776 18.969141 20.884635
    H 10.463238 17.637861 21.989786
    N 15.049108 15.306040 19.291189
    C 15.887887 14.916279 20.406598
    C 17.201480 15.683970 20.366524
    O 17.705731 16.108288 21.403889
    H 14.769189 14.596113 18.629563
    H 15.370765 15.128613 21.342333
    C 16.130803 13.407240 20.366186
    C 17.011596 12.920343 21.517262
    C 17.254512 11.411304 21.476850
    C 18.135305 10.924408 22.627926
    N 18.347442 9.470503 22.557211
    H 16.552779 13.110497 19.405988
    H 15.185336 12.865132 20.348555
    H 16.589619 13.217086 22.477460
    H 17.957063 13.462451 21.534893
    H 17.676489 11.114562 20.516652
    H 16.309045 10.869196 21.459219
    H 17.689739 11.180775 23.589096
    H 19.098984 11.433641 22.617715
    H 18.931064 9.177083 23.327529
    H 18.799090 9.237748 21.684320
    H 17.456891 8.996913 22.609486
    N 17.753994 15.860900 19.164172
    C 19.003341 16.574676 18.993133
    C 18.865430 18.000872 19.506389
    O 19.836601 18.474102 20.135182
    H 17.296102 15.490547 18.343639
    H 19.792580 16.064110 19.544969
    C 19.409441 16.556987 17.519155
    C 20.723829 17.294042 17.260364
    C 21.129929 17.276353 15.786386
    N 22.389896 17.989554 15.576158
    C 22.966674 18.121315 14.373840
    N 24.122589 18.788608 14.254761
    N 22.387536 17.585783 13.290602
    H 18.612115 16.960428 16.894970
    H 19.461354 15.534144 17.146063
    H 21.521155 16.890602 17.884549
    H 20.671916 18.316885 17.633456
    H 20.351716 17.722216 15.166958
    H 21.226915 16.252332 15.425726
    H 22.837235 18.398172 16.384254
    H 24.557325 18.887920 13.348537
    H 24.559104 19.192255 15.071232
    H 22.822271 17.685096 12.384378
    H 21.516286 17.082824 13.380356
    O 17.791418 18.591174 19.260338
    """)
    atom_types=[230,
    236,
    177,
    178,
    233,
    233,
    233,
    85,
    80,
    85,
    85,
    85,
    180,
    165,
    177,
    178,
    183,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    82,
    80,
    80,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    82,
    80,
    80,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    82,
    80,
    81,
    80,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    181,
    188,
    177,
    178,
    85,
    81,
    81,
    187,
    85,
    85,
    85,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    99,
    96,
    85,
    85,
    97,
    180,
    166,
    177,
    178,
    183,
    85,
    100,
    96,
    80,
    85,
    97,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    148,
    142,
    85,
    85,
    146,
    180,
    166,
    177,
    178,
    183,
    85,
    94,
    90,
    90,
    90,
    90,
    90,
    90,
    85,
    85,
    91,
    91,
    91,
    91,
    91,
    180,
    166,
    177,
    178,
    183,
    85,
    94,
    90,
    90,
    90,
    90,
    90,
    108,
    109,
    85,
    85,
    91,
    91,
    91,
    91,
    110,
    180,
    166,
    177,
    178,
    183,
    85,
    446,
    451,
    453,
    451,
    450,
    453,
    85,
    85,
    454,
    91,
    91,
    454,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    441,
    455,
    442,
    444,
    443,
    90,
    90,
    90,
    90,
    85,
    85,
    91,
    445,
    91,
    91,
    91,
    91,
    180,
    166,
    177,
    178,
    183,
    85,
    216,
    213,
    214,
    214,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    177,
    178,
    179,
    85,
    85,
    182,
    182,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    216,
    213,
    214,
    214,
    85,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    81,
    177,
    178,
    179,
    85,
    85,
    85,
    85,
    182,
    182,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    152,
    144,
    151,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    180,
    166,
    177,
    178,
    183,
    85,
    81,
    81,
    81,
    235,
    230,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    85,
    233,
    233,
    233,
    180,
    225,
    213,
    214,
    183,
    85,
    81,
    251,
    250,
    246,
    245,
    243,
    243,
    85,
    85,
    85,
    85,
    85,
    85,
    247,
    244,
    244,
    244,
    244,
    214,]
    ff="OPLSAA"
    model="HARMONICOSCILLATOR"
    coord="BOND"
    mod_key="H.O."
    mm.load_module("fmanii","FFTerm",mod_key)
    mm.change_option(mod_key,"FORCE_FIELD",ff)
    mm.change_option(mod_key,"ATOM_TYPES",atom_types)
    mm.change_option(mod_key,"MODEL_NAME","ALL")
    mm.change_option(mod_key,"COORD_NAME","ALL")
    my_mod=mm.get_module(mod_key,0)
    newwfn,deriv=my_mod.deriv(0,wfn)
    print(deriv)
    tester.print_results()
    return tester.nfailed()

def run_test():
    with psr.ModuleAdministrator() as mm:
        return run(mm)

