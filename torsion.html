<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ForceManII: Torsion Angle Class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ForceManII
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">MM for QM People</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Torsion Angle Class </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section warning"><dt>Warning</dt><dd>Energies computed by ForcemanII for the improper torsional energetic components may differ from those of other programs. This is because the improper torsion angle is ill-defined and its value usually depends on the order the atoms are input. We aim for a value that is independent of such conventions and instead use the average of all possible ways of computing the angle. See the improper torsion angle section below for more details.</dd></dl>
<h2>Proper Torsion Angle</h2>
<h3>0-th Derivative</h3>
<p>Assume that atom 1 is bonded to atom 2; atom 2 is bonded to atom3, and atom 3 is bonded to atom 4. If we look down the 2-3 bond the 1-2 and 2-3 bonds will make an angle. This angle is the torsion angle. Mathematically this can be viewed as the angle between plane comprised of atoms 1,2, and 3 and the plane comprised of the atoms 2,3,4. Let <img class="formulaInl" alt="$\vec{r_{21}}$" src="form_123.png"/> be a vector parallel to the 1-2 bond pointing from atom 2 to atom 1, <img class="formulaInl" alt="$\vec{r_{23}}$" src="form_124.png"/> be a vector parallel to the 2-3 bond pointing from atom 2 to atom 3, and <img class="formulaInl" alt="$\vec{r_{34}}$" src="form_125.png"/> be a vector parallel to the 3-4 bond pointing from atom 3 to atom 4. <img class="formulaInl" alt="$\vec{n_1}=\vec{r_{21}}\times\vec{r_{23}}$" src="form_126.png"/> is a vector normal to the plane containing atoms 1, 2, and 3 and <img class="formulaInl" alt="$\vec{n_2}=\vec{r_{34}}\times\vec{r_{23}}$" src="form_127.png"/> is a vector normal to the plane containing atoms 2, 3, and 4. The dihedral angle, <img class="formulaInl" alt="$\phi$" src="form_128.png"/> is then given using the procedure described in the <a class="el" href="angle.html">angle section</a>, namely: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tan\phi=\frac{||\vec{n_1}\times\vec{n_2}||}{\vec{n}_{1}\cdot\vec{n}_2} \]" src="form_129.png"/>
</p>
<p>As far as symmetries of the torsion angle are concerned, we have one degree of freedom, we can read the sequence forward or backward.</p>
<h3>Gradient of a Torsion</h3>
<p>Much of this derivation follows from the derivation of the gradient of an angle, hence missing steps can be found <a class="el" href="angle.html">on the angle page</a>.</p>
<p>As with the angle scenario we work out <img class="formulaInl" alt="$\frac{\partial \vec{n}_1\cdot\vec{n}_2}{\partial \vec{r}_i}$" src="form_130.png"/> first: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial \vec{n}_1\cdot\vec{n}_2}{\partial \vec{r}_i}= \vec{n}_2\cdot\frac{\partial \vec{n}_1}{\partial \vec{r}_i}+ \vec{n}_1\cdot\frac{\partial \vec{n}_2}{\partial \vec{r}_i} \]" src="form_131.png"/>
</p>
<p>Now for the derivative of the magnitude of the cross product: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial ||\vec{n}_1\times\vec{n}_2||}{\partial \vec{r}_i}= \frac{\vec{n}_1\times\vec{n}_2}{||\vec{n}_1\times\vec{n}_2||}\cdot \left[\frac{\partial \vec{n}_1}{\partial \vec{r}_i}\times\vec{n}_2+ \partial \vec{n}_1\times\frac{\vec{n}_2}{\partial \vec{r}_i}\right] \]" src="form_132.png"/>
</p>
<p>Defining a vector <img class="formulaInl" alt="$\vec{A}=\vec{n}_1\times\vec{n}_2$" src="form_133.png"/>: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \vec{A}\cdot\left[\frac{\partial \vec{n}_1}{\partial \vec{r}_i}\times\vec{n}_2+ \vec{n}_1\times\frac{\vec{n}_2}{\partial \vec{r}_i}\right]= \frac{\partial \vec{n}_1}{\partial \vec{r}_i}\cdot\vec{n}_2\times\vec{A}+ \frac{\vec{n}_2}{\partial \vec{r}_i}\cdot\vec{A}\times\vec{n}_1 \]" src="form_134.png"/>
</p>
<p>The two partial derivatives we need are: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \frac{\partial \vec{n}_1}{\partial \vec{r}_i}=&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\times\vec{r}_{23}+ \vec{r}_{21}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\\ \frac{\partial \vec{n}_2}{\partial \vec{r}_i}=&amp; \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\times\vec{r}_{23}+ \vec{r}_{34}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\\ \end{align*}" src="form_135.png"/>
</p>
<p>Substituting into the dot product term: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \frac{\partial \vec{n}_1\cdot\vec{n}_2}{\partial \vec{r}_i}=&amp; \vec{n}_2\cdot\frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\times\vec{r}_{23}+ \vec{n}_2\cdot\vec{r}_{21}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}+ \vec{n}_1\cdot\frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\times\vec{r}_{23}+ \vec{n}_1\cdot\vec{r}_{34}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\\ =&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\vec{n}_2+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\vec{n}_2\times\vec{r}_{21}+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\vec{n}_1+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\vec{n}_1\times\vec{r}_{34}\\ =&amp;\frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\vec{n}_2+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot \left(\vec{n}_2\times\vec{r}_{21}+\vec{n}_1\times\vec{r}_{34}\right)+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\vec{n}_1 \end{align*}" src="form_136.png"/>
</p>
<p>Thus the gradient of the dot-product is: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \bigtriangledown \left(\vec{n}_1\cdot\vec{n}_2\right)=&amp;\begin{bmatrix} -\vec{r}_{23}\times\vec{n}_2&amp; \vec{r}_{23}\times\vec{n}_2+ \left(\vec{n}_2\times\vec{r}_{21}+\vec{n}_1\times\vec{r}_{34}\right)&amp; -\left(\vec{n}_2\times\vec{r}_{21}+\vec{n}_1\times\vec{r}_{34}\right)+ \vec{r}_{23}\times\vec{n}_1&amp; -\vec{r}_{23}\times\vec{n}_1 \end{bmatrix}\\ =&amp;\begin{bmatrix} \vec{n}_2\times\vec{r}_{23}&amp; \vec{n}_1\times\vec{r}_{34}+\vec{n}_2\times\vec{r}_{31}&amp; \vec{n}_1\times\vec{r}_{42}-\vec{n}_2\times\vec{r}_{21}&amp; \vec{n}_1\times\vec{r}_{23} \end{bmatrix}\\ \end{align*}" src="form_137.png"/>
</p>
<p>Substituting into the cross product term: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \frac{\partial \vec{n}_1}{\partial \vec{r}_i}\cdot\vec{n}_2\times\vec{A}+ \frac{\vec{n}_2}{\partial \vec{r}_i}\cdot\vec{A}\times\vec{n}_1=&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\times\vec{r}_{23}\cdot\vec{n}_2\times\vec{A}+ \vec{r}_{21}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\vec{n}_2\times\vec{A}+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\times\vec{r}_{23}\cdot\vec{A}\times\vec{n}_1+ \vec{r}_{34}\times\frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\vec{A}\times\vec{n}_1\\ =&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\cdot \vec{r}_{23}\times\left(\vec{n}_2\times\vec{A}\right)+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot \left(\vec{n}_2\times\vec{A}\right)\times\vec{r}_{21}+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\left(\vec{A}\times\vec{n}_1\right)+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\left(\vec{A}\times\vec{n}_1\right)\times\vec{r}_{34}\\ =&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\cdot \vec{r}_{23}\times\left(\vec{n}_2\times\vec{A}\right)+ \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot \left[\left(\vec{n}_2\times\vec{A}\right)\times\vec{r}_{21}+ \left(\vec{A}\times\vec{n}_1\right)\times\vec{r}_{34}\right]+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\cdot\vec{r}_{23}\times\left(\vec{A}\times\vec{n}_1\right)\\ =&amp; \frac{\partial \vec{r}_{21}}{\partial \vec{r}_i}\cdot\left[ \vec{n}_2\left(\vec{r}_{23}\cdot \vec{A}\right)-\vec{A}\left(\vec{r}_{23}\cdot\vec{n}_2\right)\right]- \frac{\partial \vec{r}_{23}}{\partial \vec{r}_i}\cdot\left[ \vec{n}_2\left(\vec{r}_{21}\cdot\vec{A}\right)-\vec{A}\left(\vec{r}_{21}\cdot\vec{n}_2\right)+ \vec{A}\left(\vec{r}_{34}\cdot\vec{n}_1\right)- \vec{n}_1\left(\vec{r}_{34}\cdot\vec{A}\right)\right]+ \frac{\partial \vec{r}_{34}}{\partial \vec{r}_i}\cdot\left[ \vec{A}\left(\vec{r}_{23}\cdot\vec{n}_1\right)- \vec{n}_1\left(\vec{r}_{23}\cdot\vec{A}\right)\right] \end{align*}" src="form_138.png"/>
</p>
<p>where we have used the identity <img class="formulaInl" alt="$\vec{a}\times\left(\vec{b}\times\vec{c}\right)= \vec{b}(\vec{a}\cdot\vec{c})-\vec{c}(\vec{a}\cdot\vec{b})$" src="form_139.png"/></p>
<p>Thus the gradient of the cross-product term is: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{align*} \bigtriangledown\left(\vec{A}\cdot\vec{n}_1\times\vec{n}_2\right)=&amp;\begin{bmatrix} \vec{A}\left(\vec{r}_{23}\cdot\vec{n}_2\right)- \vec{n}_2\left(\vec{r}_{23}\cdot \vec{A}\right)\\ \vec{A}\left[\left(\vec{r}_{31}\cdot\vec{n}_2\right)- \left(\vec{r}_{34}\cdot\vec{n}_1\right)\right]- \vec{n}_2\left(\vec{r}_{31}\cdot \vec{A}\right)+ \vec{n}_1\left(\vec{r}_{34}\cdot\vec{A}\right) \\ -\vec{A}\left[\left(\vec{r}_{21}\cdot\vec{n}_2\right)+ \left(\vec{r}_{42}\cdot\vec{n}_1\right)\right]+ \vec{n}_1\left(\vec{r}_{42}\cdot\vec{A}\right)+ \vec{n}_2\left(\vec{r}_{21}\cdot\vec{A}\right) \\ \vec{n}_1\left(\vec{r}_{23}\cdot\vec{A}\right)- \vec{A}\left(\vec{r}_{23}\cdot\vec{n}_1\right) \end{bmatrix}^{T} \end{align*}" src="form_140.png"/>
</p>
<p>Consequentially: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \bigtriangledown \phi= \frac{1}{\vec{A}{}^2+\left(\vec{n}_1\cdot\vec{n}_2\right)^2}\left[ \frac{\bigtriangledown\left(\vec{A}\cdot\vec{n}_1\times\vec{n}_2\right)}{\tan\phi} -A\bigtriangledown \left(\vec{n}_1\cdot\vec{n}_2\right)\right] \]" src="form_141.png"/>
</p>
<h2>Improper Torsion</h2>
<p>Related to the torsion angle, the improper torsion angle measures the planarity around an sp <img class="formulaInl" alt="$^2$" src="form_122.png"/> hybridized atom. Instead of being a non-branching path i.e. 1 is connected to 2, which is connected to 3, which is connected to 4, the atoms in an improper torsion are all bonded to atom 2. It should be noted that there are other conventions for which atom the central atom is (usually that it is atom 3), but we choose it to be atom 2 as this is naturally where it falls when looping over connectivity. This all seems well and good, but now let's show you why this term is miserable (if an expert out there wants to enlighten me on this issue, please contact me, I desperately would like some clarification).</p>
<p>To do this note a few properties of the improper dihedral angle. Assume for a quadruple of atoms <img class="formulaInl" alt="$\lbrace a_1,a_2,a_3,a_4\rbrace$" src="form_142.png"/>, we always compute our dihedral angle as the angle between the planes formed from the first three atoms, <img class="formulaInl" alt="$a_1, a_2, a_3$" src="form_143.png"/>, and the last three atoms, <img class="formulaInl" alt="$a_2, a_3, a_4$" src="form_144.png"/>. To make this more concrete consider the following example. Our atoms are located at:</p>
<table class="doxtable">
<tr>
<th>Atom Label </th><th>X (Angstroms) </th><th>Y (Angstroms) </th><th>Z (Angstroms)</th></tr>
<tr>
<td>a1 </td><td>-43.602241118 </td><td>-24.338026677 </td><td>1.84859610285 </td></tr>
<tr>
<td>a2 </td><td>-41.923081627 </td><td>-25.865577231 </td><td>0.23207724871 </td></tr>
<tr>
<td>a3 </td><td>-42.764850620 </td><td>-26.397217623 </td><td>-1.8646417662 </td></tr>
<tr>
<td>a4 </td><td>-39.789193592 </td><td>-26.335512401 </td><td>1.14099009599 </td></tr>
</table>
<p>By considering all six permutations of the orbital atoms we generate the following improper torsional angles:</p>
<table class="doxtable">
<tr>
<th>Permuation </th><th>Angle Value (radians)</th></tr>
<tr>
<td>1,2,3,4 </td><td>-3.0739165910027615 </td></tr>
<tr>
<td>3,2,1,4 </td><td>3.0833170468335953 </td></tr>
<tr>
<td>3,2,4,1 </td><td>3.0739165910027615 </td></tr>
<tr>
<td>1,2,4,3 </td><td>-3.0833170468335958 </td></tr>
<tr>
<td>4,2,1,3 </td><td>3.073975669189943 </td></tr>
<tr>
<td>4,2,3,1 </td><td>-3.073975669189943 </td></tr>
</table>
<p>As you can see (up to a sign) there are three unique angles that can be generated by permuting the definitions of what atom is 1, 3, and 4. By only considering one set of cyclic permutations we can always ensure we get angles with the same sign.</p>
<p>This convention assumes that center atom is second. If we compute the angles in the same manner (dihedral between the first three and second three atoms), but switch the center atom to atom 3 we get the same angles, but with opposite sign (this makes sense we have just flipped the definition of which plane is first). This is the convention used by Tinker and because cosine is an even function the difference in sign does not matter for a Fourier series expansion. The CHARMM force field makes the convention that the central atom is listed first (or last at the cost of a sign caused be changing the definition of which plane is first). Using the same atoms, let's see what happens when the central atom is now listed first:</p>
<table class="doxtable">
<tr>
<th>Permuation </th><th>Angle Value (radians) </th></tr>
<tr>
<td>2,1,3,4 </td><td>0.03356224876458078 </td></tr>
<tr>
<td>2,3,1,4 </td><td>-0.03356224876458085 </td></tr>
<tr>
<td>2,3,4,1 </td><td>0.04481843274914807 </td></tr>
<tr>
<td>2,1,4,3 </td><td>-0.03315167722736386 </td></tr>
<tr>
<td>2,4,1,3 </td><td>0.03315167722736379 </td></tr>
<tr>
<td>2,4,3,1 </td><td>-0.044818432749148006 </td></tr>
</table>
<p>Again we end up with three unique angles (up to a sign), with the same sign being given by permutations that are cyclically related. So far so good, unfortunately, there is not an easy relation between these three unique angles and the three unique angle given by our (or Tinker's) conventions. More specifically they are not just related by a rotation of <img class="formulaInl" alt="$\pm\pi$" src="form_145.png"/> (this would have made sense as the zero of energy for the first set of angles is <img class="formulaInl" alt="$\pi$" src="form_146.png"/> and is 0 for the second set. As this ordering seems unique to CHARMM we have chooosen to reorder all CHARMM improper torsions and change their equilibrium distances from 0 radians to <img class="formulaInl" alt="$\pi$" src="form_146.png"/> radians. Now we are at least computing the same set of angles, regardless of the force field.</p>
<p>We still have the conundrum of how to uniquely pick which of the three angles we declare "the improper torsion angle". After a long search, from what I can tell, the "standard" (I have no idea how many packages actually abide by this) way to ensure one always uses the same improper torsion is given on <a href="http://chempedia.info/info/165388/">this website</a>. Basically they suggest that the order of the orbtial atoms is that of their input to the program and the central atom is given third for all force fields that are not CHARMM, and first for CHARMM (again, our code requests that the central atom is given second regardless of the force field). This means simply reordering the atoms in the input file changes the value of the angle, which in my opinion is unacceptable.</p>
<p>Since I'm trying to compare to Tinker, let's consider their convention. Well short answer is I can't seem to find it. Based on Tinker's CHARMM22 parameter file we can gain some insight. To this end, consider the improper torsion made among the CHARMM22 classes: 6, 20, 29, and 30 (listed in our order). These map to H, C, N, N. This angle should be symmetric about the H-C bond. The comment in the file suggests that CHARMM's parameters are defined such that both the angle: 6, 20, 29, 30 and the angle: 6, 20, 30, 29 would be computed in the CHARMM package (and the energetic contributions from both would be included). Note that CHARMM's ordering of parameters makes the minimum energy at 0 radians so the harmonic description is insensitive to the sign change engendered by this case. Tinker apparently computes this angle once (making matters more complicated it appears to be for the 30, 20, 29, 6 value) so they decide to double the force constant because they will be dividing by 2 in the actual energy expression they have coded up. From this I assume that CHARMM assures angles that should be symmetric, are symmetric by averaging the two angles that should be symmetric (it is conceivable this is then averaged with the remaining unique angle and/or that for other angles all three values are averaged together, but I can not infer that from this). Tinker on the other hand, computes the value once (and then conceivably averages this value with that of the other unique angle).</p>
<p>Punchline is there appears to be no real convention, so I'm going to do whatever I want. In particular, I am going to take the easiest solution to this problem I can see. We know that we get in general three unique angles depending on the order, but how much do they really differ from one another? By taking the improper angles in ubiquitin as a test set, I have computed the standard deviation in the magnitude of the improper torsion resulting from the three cyclic permuations of each improper torsion angle. The result is, that on average, these permutations can change the angle by about <img class="formulaInl" alt="$\pm 0.25$" src="form_147.png"/> degrees. To me this suggests that the angles are basically interchangable and the average of the three angles should serve as a good value of "the improper
torsion angle". Moreover, the derivative of the average is straightforward as it is just the average of the derivatives. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
